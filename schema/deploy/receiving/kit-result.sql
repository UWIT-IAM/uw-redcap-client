-- Deploy seattleflu/schema:receiving/kit-result to pg
-- requires: receiving/schema

begin;

set local search_path to receiving;

create table kit_result(
    kit_result_id integer primary key generated by default as identity,

    document json not null
        constraint kit_result_document_is_object
            check (json_typeof(document) = 'object'),
    
    received timestamp with time zone not null default now(),

    processing_log jsonb not null default '[]'
        constraint kit_result_processing_log_is_array
            check (jsonb_typeof(processing_log) = 'array')
);

comment on table kit_result is 
    'Append-only set of kit result documents';

comment on column kit_result.kit_result_id is
    'Internal id of this record';

comment on column kit_result.document is
    'JSON document created from a pre-processed Excel/CSV file';

comment on column kit_result.received is 
    'When the document was received';

comment on column kit_result.processing_log is
    'Even log recording detals of ETL into the warehouse';

commit;
